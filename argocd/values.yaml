app-secrets:
  external:
    secretName: argocd-secret
    values:
      "dex.github.clientID": /argocd/GITHUB_CLIENT_ID
      "dex.github.clientSecret": /argocd/GITHUB_CLIENT_SECRET
      "admin.password": /argocd/ADMIN_PASSWORD
      "admin.passwordMtime": /argocd/ADMIN_MTIME
      "server.secretkey": /argocd/SERVER_SECRET_KEY
      "webhook.github.secret": /argocd/GITHUB_WEBHOOK_SECRET

defaultRepoUrl: 'https://github.com/aeternity/gitops-tools.git'

namespaces:
  - tools
  - apps
  - aenodes

projects:
  - name: tools
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations:
      # keep the resource during migration
      "helm.sh/resource-policy": keep
    description: Tools used to run the environment
    sourceRepos:
      - 'https://github.com/aeternity/gitops-tools.git'
    destinations:
      - namespace: default
        server: https://kubernetes.default.svc
      - namespace: tools
        server: https://kubernetes.default.svc
        # allow configuration of LimitRanges and other globals
      - namespace: apps
        server: https://kubernetes.default.svc
      - namespace: argocd
        server: https://kubernetes.default.svc
      - namespace: kube-system
        server: https://kubernetes.default.svc
      - namespace: traefik
        server: https://kubernetes.default.svc
      - namespace: monitoring
        server: https://kubernetes.default.svc
      - namespace: logging
        server: https://kubernetes.default.svc
      - namespace: aenodes
        server: https://kubernetes.default.svc
      - namespace: external-secrets
        server: https://kubernetes.default.svc
      - namespace: cert-manager
        server: https://kubernetes.default.svc
      - namespace: redis
        server: https://kubernetes.default.svc
    clusterResourceWhitelist:
      - group: '*'
        kind: '*'
  - name: apps
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations:
      # keep the resource during migration
      "helm.sh/resource-policy": keep
    description: Applications deployed on EKS
    sourceRepos:
      - 'https://github.com/aeternity/gitops-apps.git'
      - 'https://github.com/aeternity/gitops-apps-aelabs.git'
    destinations:
      - namespace: apps
        server: https://kubernetes.default.svc
    clusterResourceWhitelist:
      - group: '*'
        kind: '*'
  - name: aenodes
    namespace: argocd
    additionalLabels: {}
    additionalAnnotations: {}
    description: AEnodes deployed on EKS
    sourceRepos:
      - 'https://github.com/aeternity/gitops-nodes.git'
    destinations:
      - namespace: aenodes
        server: https://kubernetes.default.svc
      - namespace: kube-system
        server: https://kubernetes.default.svc
    clusterResourceWhitelist:
      - group: '*'
        kind: '*'

applications:
  - name: argocd
    project: tools
    namespace: argocd
  - name: external-secrets
    project: tools
    namespace: external-secrets
  - name: aws-load-balancer-controller
    project: tools
    namespace: kube-system
  - name: metrics-server
    project: tools
    namespace: kube-system
  - name: traefik
    project: tools
    namespace: traefik
  - name: kube-prometheus-stack
    project: tools
    namespace: monitoring
    serverSideApply: true
  - name: kube-prometheus-blackbox-exporter
    project: tools
    namespace: monitoring
  - name: fluent-bit
    project: tools
    namespace: tools
  - name: cluster-autoscaler
    project: tools
    namespace: tools
  - name: vpa
    project: tools
    namespace: tools
  - name: kubernetes-event-exporter
    project: tools
    namespace: monitoring
  - name: velero
    project: tools
    namespace: tools
  - name: cert-manager
    project: tools
    namespace: cert-manager
  - name: redis
    project: tools
    namespace: redis

  - name: aemon-testnet
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: aemon-mainnet
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: aerepl-web
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: aesophia-http
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: aepp-faucet
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: aepp-faucet-nodejs
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: aepp-contracts
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: mdw-frontend-testnet
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: mdw-frontend-mainnet
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: aepp-base
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: governance-server-mainnet
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: governance-server-testnet
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'
  - name: governance-aepp
    project: apps
    namespace: apps
    repoUrl: 'https://github.com/aeternity/gitops-apps.git'

additionalApplications: []

argo-cd:
  configs:
    secret:
      createSecret: false
    cm:
      users.anonymous.enabled: "false"
      dex.config: |
        connectors:
          - type: github
            id: github
            name: GitHub
            config:
              clientID: $dex.github.clientID
              clientSecret: $dex.github.clientSecret
              orgs:
              - name: aeternity
      resource.customizations: |
          networking.k8s.io/Ingress:
            health.lua: |
              hs = {}
              hs.status = "Healthy"
              return hs
          admissionregistration.k8s.io/MutatingWebhookConfiguration:
            ignoreDifferences: |
              jsonPointers:
              - /webhooks/0/failurePolicy
              jqPathExpressions:
              - .webhooks[]?.clientConfig.caBundle
          admissionregistration.k8s.io/ValidatingWebhookConfiguration:
            ignoreDifferences: |
              jsonPointers:
              - /webhooks/0/failurePolicy
              jqPathExpressions:
              - .webhooks[]?.clientConfig.caBundle
          apiextensions.k8s.io:
            ignoreDifferences: |
              jqPathExpressions:
              - .spec.conversion.webhook.clientConfig.caBundle
              - .spec.conversion.webhook.clientConfig.service.name
              - .spec.conversion.webhook.clientConfig.service.namespace
          apiextensions.k8s.io/CustomResourceDefinition:
            ignoreDifferences: |
              managedFieldsManagers:
              - external-secrets
    rbac:
      policy.default: role:readonly
      policy.csv: |
        g, aeternity:devops, role:admin
    repositories:
      tools:
        url: https://github.com/aeternity/gitops-tools.git
      apps:
        url: https://github.com/aeternity/gitops-apps.git
      apps-aelabs:
        url: https://github.com/aeternity/gitops-apps-aelabs.git
      nodes:
        url: https://github.com/aeternity/gitops-nodes.git
      argo-helm:
        type: helm
        url: https://argoproj.github.io/argo-helm
        name: argo
      traefik-helm:
        type: helm
        url: https://helm.traefik.io/traefik
        name: traefik
      prometheus-helm:
        type: helm
        url: https://prometheus-community.github.io/helm-charts
        name: prometheus-community
      backube-helm:
        type: helm
        url: https://backube.github.io/helm-charts/
        name: backube
      eks-helm:
        type: helm
        url: https://aws.github.io/eks-charts
        name: eks
      bitnami-helm:
        type: helm
        url: https://charts.bitnami.com/bitnami
        name: bitnami
      fluent-helm:
        type: helm
        url: https://fluent.github.io/helm-charts
        name: fluent
      autoscaler-helm:
        type: helm
        url: https://kubernetes.github.io/autoscaler
        name: cluster-autoscaler
      valero-helm:
        type: helm
        url: https://vmware-tanzu.github.io/helm-charts
        name: velero
      external-secrets-helm:
        type: helm
        url: https://charts.external-secrets.io
        name: external-secrets
      cert-manager-helm:
        type: helm
        url: https://charts.jetstack.io
        name: cert-manager
      vpa:
        type: helm
        url: https://charts.fairwinds.com/stable
        name: vpa

  applicationSet:
    enabled: false

  controller:
    resources:
      requests:
        cpu: 200m
        memory: 768Mi
    extraArgs:
      - --repo-server-timeout-seconds
      - "360"
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true

  repoServer:
    resources:
      requests:
        cpu: 100m
        memory: 512Mi
    env:
      - name: "ARGOCD_EXEC_TIMEOUT"
        value: "3m"
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true

  dex:
    resources:
      limits:
        memory: 64Mi
      requests:
        cpu: 100m
        memory: 64Mi
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true

  server:
    resources:
      limits:
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 256Mi
    metrics:
      enabled: true
      serviceMonitor:
        enabled: true
    ingress:
      enabled: true
      annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        cert-manager.io/cluster-issuer: letsencrypt
      pathType: ImplementationSpecific
    extraArgs:
      - --insecure=true
      - --repo-server-timeout-seconds=180

  redis:
    resources:
      limits:
        memory: 128Mi
      requests:
        cpu: 100m
        memory: 128Mi

  notifications:
    enabled: false
